<%= form_with model: toy, local: true, html: { multipart: true, class: "mt-4 w-100" } do |f| %>
  <div class="form-group d-flex align-items-center">
    <label for="toy_image_input" class="mr-3 mb-0" style="width: 180px;">画像</label>
    <div>
      <%= f.file_field :toy_image, accept: "image/*", id: "toy_image_input", class: "form-control-file" %>
      <div class="mt-2">
        <% if toy.toy_image.attached? %>
          <img id="preview_image" src="<%= url_for(toy.toy_image.variant(resize_to_limit: [150, 150])) %>" alt="プレビュー画像" class="img-thumbnail" style="max-width: 150px;">
        <% else %>
          <img id="preview_image" src="" alt="プレビュー画像" class="img-thumbnail d-none" style="max-width: 150px;">
        <% end %>
      </div>
    </div>
  </div>

  <div class="form-group d-flex align-items-center">
    <label class="mr-3 mb-0" style="width: 180px;">名前（30文字以内）</label>
    <%= f.text_field :name, class: "form-control", style: "width: 400px;" %>
  </div>

  <div class="form-group d-flex">
    <label class="mr-3" style="width: 180px;">紹介文（300文字以内）</label>
    <%= f.text_area :introduction, class: "form-control", rows: 5, style: "width: 400px;" %>
  </div>

  <div class="form-group text-center">
    <% if toy.id.nil? %>
      <%= f.submit '登録', class: "btn btn-primary" %>
    <% else %>
      <%= f.submit '更新', class: "btn btn-success" %>
    <% end %>
  </div>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("toy_image_input");
    const preview = document.getElementById("preview_image");

    input.addEventListener("change", event => {
      const file = event.target.files[0];
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = e => {
          preview.src = e.target.result;
          preview.classList.remove("d-none"); // ← これを追加！
        };
        reader.readAsDataURL(file);
      } else {
        preview.src = "";
        preview.classList.add("d-none");
      }
    });
  });
</script>