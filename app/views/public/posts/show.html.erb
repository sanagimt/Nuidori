<div class="container mt-5">
  <div class="text-center mb-4">
    <% if @post.get_image_original(400, 400).present? %>
      <%= image_tag @post.get_image_original(400, 400), class: "img-fluid rounded shadow-sm border" %>
    <% else %>
      <%= image_tag "default-image.jpg", width: 400, height: 400, class: "img-fluid rounded shadow-sm border" %>
    <% end %>
  </div>

  <div class="mx-auto" style="max-width: 820px;">
    <div class="d-flex align-items-center mb-3">
      <%= link_to user_path(@post.user.username), class: "d-flex align-items-center font-weight-bold text-dark text-decoration-none" do %>
        <%= image_tag @post.user.get_profile_image(50, 50), class: "rounded-circle mr-2", style: "width: 50px; height: 50px; object-fit: cover;" %>
        <div>
          <div><%= @post.user.nickname %></div>
          <small class="text-muted">(<%= @post.user.username %>)</small>
        </div>
      <% end %>

      <% if current_user != @post.user %>
        <span id="relationship_btn_<%= @post.user.id %>" class="ml-auto">
          <%= render 'public/relationships/btn', user: @post.user %>
        </span>
      <% end %>
    </div>

    <h5 class="font-weight-bold mb-3"><%= @post.title %></h5>

    <div class="mb-4" style="white-space: pre-wrap; line-height: 1.6;">
      <%= simple_format(@post.body) %>
    </div>

    <div class="text-muted mb-4" style="font-size: 14px;">
      <p class="mb-1">投稿日時：<%= @post.created_at.strftime('%y/%m/%d %H:%M') %></p>
      <p class="mb-0">更新日時：<%= @post.updated_at.strftime('%y/%m/%d %H:%M') %></p>
    </div>

    <div id="favorite-btn-<%= @post.id %>" class="mb-4">
      <%= render 'public/favorites/btn', post: @post %>
    </div>
    
    <div class="d-flex flex-column">
      <% if @post.user == current_user %>
        <%= link_to "投稿を編集する", edit_post_path(@post), class: "btn btn-outline-primary mb-4", data: { turbolinks: false }, style: "width: 150px;" %>
      <% end %>

      <%= link_to '←投稿一覧へ戻る', posts_path, class: "btn btn-outline-secondary mb-4", style: "width: 180px;" %>
    </div>
  </div>

  <div class="mx-auto mt-5" style="max-width: 820px;">
    <%= render "public/toys/post_relation", toys: @toys %>
  </div>

  <div class="mx-auto mt-5" style="max-width: 820px;">
    <h5 class="mb-2">コメントフォーム(100文字以内)</h5>
    <%= render 'public/comments/form', post: @post, comment: @comment %>
  </div>

  <div class="mx-auto mt-5" style="max-width: 820px;">
    <h5 class="mb-3">コメント一覧</h5>
    <% if @comments.present? %>
      <%= render 'public/comments/post_comments', post: @post, comment: @comment, comments: @comments %>
    <% else %>
      <p class="text-muted">コメントはまだありません。</p>
    <% end %>
  </div>
</div>


